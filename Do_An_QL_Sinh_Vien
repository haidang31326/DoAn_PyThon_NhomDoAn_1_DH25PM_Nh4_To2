import tkinter as tk
from tkinter import ttk, messagebox
#import mysql.connector
from datetime import datetime

# Kết nối MySQL
#def connect_db():
    #return mysql.connector.connect(
        #host='localhost',  # Thay đổi nếu cần
        #user='root',       # Thay đổi nếu cần
        #password='',       # Thay đổi nếu cần
        #database='employee_db'
    #)

# Lớp ứng dụng chính
class EmployeeApp:
    def __init__(self, root):
        self.root = root
        self.root.title("Quản Lý Nhân Viên")
        self.root.geometry("800x600")

        # Biến lưu trữ
        self.selected_item = None

        # Frame nhập liệu
        input_frame = ttk.LabelFrame(root, text="Thông Tin Nhân Viên")
        input_frame.pack(pady=10, padx=10, fill="x")

        # Các trường nhập
        ttk.Label(input_frame, text="Mã số:").grid(row=0, column=0, padx=5, pady=5, sticky="w")
        self.id_entry = ttk.Entry(input_frame)
        self.id_entry.grid(row=0, column=1, padx=5, pady=5)

        ttk.Label(input_frame, text="Họ tên:").grid(row=1, column=0, padx=5, pady=5, sticky="w")
        self.full_name_entry = ttk.Entry(input_frame)
        self.full_name_entry.grid(row=1, column=1, padx=5, pady=5)

        ttk.Label(input_frame, text="Tên:").grid(row=2, column=0, padx=5, pady=5, sticky="w")
        self.first_name_entry = ttk.Entry(input_frame)
        self.first_name_entry.grid(row=2, column=1, padx=5, pady=5)

        ttk.Label(input_frame, text="Giới tính:").grid(row=3, column=0, padx=5, pady=5, sticky="w")
        self.gender_entry = ttk.Combobox(input_frame, values=["Nam", "Nữ"])
        self.gender_entry.grid(row=3, column=1, padx=5, pady=5)

        ttk.Label(input_frame, text="Ngày sinh (YYYY-MM-DD):").grid(row=4, column=0, padx=5, pady=5, sticky="w")
        self.dob_entry = ttk.Entry(input_frame)
        self.dob_entry.grid(row=4, column=1, padx=5, pady=5)

        ttk.Label(input_frame, text="Chức vụ:").grid(row=5, column=0, padx=5, pady=5, sticky="w")
        self.position_entry = ttk.Entry(input_frame)
        self.position_entry.grid(row=5, column=1, padx=5, pady=5)

        # Nút chức năng
        button_frame = ttk.Frame(input_frame)
        button_frame.grid(row=6, column=0, columnspan=2, pady=10)

        ttk.Button(button_frame, text="Thêm", command=self.add_employee).pack(side=tk.LEFT, padx=5)
        ttk.Button(button_frame, text="Sửa", command=self.edit_employee).pack(side=tk.LEFT, padx=5)
        ttk.Button(button_frame, text="Xóa", command=self.delete_employee).pack(side=tk.LEFT, padx=5)
        ttk.Button(button_frame, text="Lưu", command=self.save_employee).pack(side=tk.LEFT, padx=5)
        ttk.Button(button_frame, text="Làm mới", command=self.clear_fields).pack(side=tk.LEFT, padx=5)

        # Bảng danh sách nhân viên
        table_frame = ttk.LabelFrame(root, text="Danh Sách Nhân Viên")
        table_frame.pack(pady=10, padx=10, fill="both", expand=True)

        self.tree = ttk.Treeview(table_frame, columns=("ID", "Full Name", "First Name", "Gender", "DOB", "Position"), show="headings")
        self.tree.heading("ID", text="Mã số")
        self.tree.heading("Full Name", text="Họ tên")
        self.tree.heading("First Name", text="Tên")
        self.tree.heading("Gender", text="Giới tính")
        self.tree.heading("DOB", text="Ngày sinh")
        self.tree.heading("Position", text="Chức vụ")

        self.tree.column("ID", width=100)
        self.tree.column("Full Name", width=150)
        self.tree.column("First Name", width=100)
        self.tree.column("Gender", width=80)
        self.tree.column("DOB", width=100)
        self.tree.column("Position", width=100)

        self.tree.pack(fill="both", expand=True)
        self.tree.bind("<ButtonRelease-1>", self.on_tree_select)

        # Tải dữ liệu ban đầu
        self.load_employees()

    def load_employees(self):
        for row in self.tree.get_children():
            self.tree.delete(row)
        #conn = connect_db()
        #cursor = conn.cursor()
        #cursor.execute("SELECT * FROM employees")
        #rows = cursor.fetchall()
        #for row in rows:
            #self.tree.insert("", tk.END, values=row)
        #conn.close()
        sample_data = [
        ("1", "Nguyen Van A", "A", "Nam", "1990-01-01", "Nhân viên"),
        ("2", "Tran Thi B", "B", "Nữ", "1992-05-10", "Trưởng phòng")
        ]
        for row in sample_data:
            self.tree.insert("", tk.END, values=row)

    def add_employee(self):
        id_val = self.id_entry.get()
        full_name = self.full_name_entry.get()
        first_name = self.first_name_entry.get()
        gender = self.gender_entry.get()
        dob = self.dob_entry.get()
        position = self.position_entry.get()

        if not id_val or not full_name:
            messagebox.showerror("Lỗi", "Mã số và Họ tên là bắt buộc!")
            return

        try:
            datetime.strptime(dob, "%Y-%m-%d")
        except ValueError:
            messagebox.showerror("Lỗi", "Ngày sinh phải có định dạng YYYY-MM-DD!")
            return

        #conn = connect_db()
        #cursor = conn.cursor()
        #try:
            cursor.execute("INSERT INTO employees (id, full_name, first_name, gender, dob, position) VALUES (%s, %s, %s, %s, %s, %s)",
                           (id_val, full_name, first_name, gender, dob, position))
            conn.commit()
            messagebox.showinfo("Thành công", "Thêm nhân viên thành công!")
            self.load_employees()
            self.clear_fields()
        #except mysql.connector.Error as err:
            messagebox.showerror("Lỗi", f"Lỗi cơ sở dữ liệu: {err}")
        #finally:
            #conn.close()

    def on_tree_select(self, event):
        selected = self.tree.selection()
        if selected:
            self.selected_item = selected[0]
            values = self.tree.item(selected[0], "values")
            self.id_entry.delete(0, tk.END)
            self.id_entry.insert(0, values[0])
            self.full_name_entry.delete(0, tk.END)
            self.full_name_entry.insert(0, values[1])
            self.first_name_entry.delete(0, tk.END)
            self.first_name_entry.insert(0, values[2])
            self.gender_entry.set(values[3])
            self.dob_entry.delete(0, tk.END)
            self.dob_entry.insert(0, values[4])
            self.position_entry.delete(0, tk.END)
            self.position_entry.insert(0, values[5])

    def edit_employee(self):
        if not self.selected_item:
            messagebox.showwarning("Cảnh báo", "Chọn một nhân viên để sửa!")
            return
        # Chỉ cần điền thông tin, sau đó nhấn Lưu để cập nhật

    def save_employee(self):
        if not self.selected_item:
            messagebox.showwarning("Cảnh báo", "Chọn một nhân viên để lưu!")
            return

        id_val = self.id_entry.get()
        full_name = self.full_name_entry.get()
        first_name = self.first_name_entry.get()
        gender = self.gender_entry.get()
        dob = self.dob_entry.get()
        position = self.position_entry.get()

        if not id_val or not full_name:
            messagebox.showerror("Lỗi", "Mã số và Họ tên là bắt buộc!")
            return

        try:
            datetime.strptime(dob, "%Y-%m-%d")
        except ValueError:
            messagebox.showerror("Lỗi", "Ngày sinh phải có định dạng YYYY-MM-DD!")
            return

        #conn = connect_db()
        #cursor = conn.cursor()
        #try:
            cursor.execute("UPDATE employees SET full_name=%s, first_name=%s, gender=%s, dob=%s, position=%s WHERE id=%s",
                           (full_name, first_name, gender, dob, position, id_val))
            conn.commit()
            messagebox.showinfo("Thành công", "Cập nhật nhân viên thành công!")
            self.load_employees()
            self.clear_fields()
            self.selected_item = None
        #except mysql.connector.Error as err:
            messagebox.showerror("Lỗi", f"Lỗi cơ sở dữ liệu: {err}")
        #finally:
            conn.close()

    def delete_employee(self):
        if not self.selected_item:
            messagebox.showwarning("Cảnh báo", "Chọn một nhân viên để xóa!")
            return

        if messagebox.askyesno("Xác nhận", "Bạn có chắc muốn xóa nhân viên này?"):
            values = self.tree.item(self.selected_item, "values")
            id_val = values[0]
            #conn = connect_db()
            #cursor = conn.cursor()
            #try:
                #cursor.execute("DELETE FROM employees WHERE id=%s", (id_val,))
                #conn.commit()
                #messagebox.showinfo("Thành công", "Xóa nhân viên thành công!")
                #self.load_employees()
                #self.clear_fields()
                #self.selected_item = None
            #except mysql.connector.Error as err:
                #messagebox.showerror("Lỗi", f"Lỗi cơ sở dữ liệu: {err}")
            #finally:
                #conn.close()

    def clear_fields(self):
        self.id_entry.delete(0, tk.END)
        self.full_name_entry.delete(0, tk.END)
        self.first_name_entry.delete(0, tk.END)
        self.gender_entry.set("")
        self.dob_entry.delete(0, tk.END)
        self.position_entry.delete(0, tk.END)
        self.selected_item = None

# Chạy ứng dụng
if __name__ == "__main__":
    root = tk.Tk()
    app = EmployeeApp(root)
    root.mainloop()
